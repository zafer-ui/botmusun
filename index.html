<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zafer'in Bot √ñl√ßer Sitesi</title>
<link rel="icon" type="image/png" href="favicon.png">
<style>
  :root { --bg:#061126; --accent:#30cfd0; }
  * { box-sizing:border-box; }
  body {
    margin:0; min-height:100vh;
    background:linear-gradient(180deg,#021021,var(--bg));
    font-family:Inter,system-ui,Arial; color:var(--accent);
    display:flex; align-items:center; justify-content:center; padding:20px;
  }
  .wrap {
    max-width:900px; width:100%;
    background:rgba(255,255,255,0.03);
    padding:18px; border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
  }
  h1{margin:0 0 6px;font-size:24px;text-align:center;color:#4dd0e1}
  h2{margin:0 0 18px;font-size:16px;text-align:center;color:#bce8f0;font-weight:normal}
  p{margin:0 0 12px;color:#bfe8e9;text-align:center}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-bottom:12px}
  input[type=file]{color:var(--accent);max-width:220px}
  button{background:var(--accent);color:#012;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;flex-shrink:0}
  select{padding:6px;border-radius:6px;border:none;background:rgba(255,255,255,0.03);color:var(--accent)}
  .stage{display:flex;flex-wrap:wrap;gap:14px;align-items:flex-start;justify-content:center}
  canvas{background:#071020;border-radius:8px;width:100%;max-width:480px;height:auto}
  #results{flex:1;min-width:200px}
  .resultItem{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;margin-bottom:8px;color:#dff7f6}
  .disclaimer{font-size:12px;color:#b6d9d8;margin-top:10px;text-align:center}
  .tag{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.05);color:#bde}

  @media (max-width:600px) {
    h1{font-size:20px} h2{font-size:14px} p{font-size:13px}
    .controls{flex-direction:column;align-items:stretch}
    input[type=file],button,select{width:100%;text-align:center}
    .stage{flex-direction:column;align-items:center} #results{width:100%}
     }
  /* üí• Y√ºz kutularƒ± i√ßin parlama animasyonu */
@keyframes glow {
  0% { box-shadow: 0 0 10px rgba(255,0,0,0.3); }
  50% { box-shadow: 0 0 25px rgba(255,0,0,0.9); }
  100% { box-shadow: 0 0 10px rgba(255,0,0,0.3); }
}
</style>
<script defer src="https://unpkg.com/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>Zafer'in Bot √ñl√ßer Sitesi</h1>
    <h2>Ben <strong>Zafer</strong>, bu siteyi <strong>Serhat √∂ƒüretmenim</strong> i√ßin yaptƒ±m ‚ù§Ô∏è</h2>
    <p>Fotoƒüraftaki y√ºzleri algƒ±lar ve <strong>≈üaka ama√ßlƒ±</strong> rastgele bir y√ºzde atar.<br>
    Renk: d√º≈ü√ºk ‚Üí ye≈üil üíö | orta ‚Üí sarƒ± üíõ | y√ºksek ‚Üí kƒ±rmƒ±zƒ± ‚ù§Ô∏è</p>

    <div class="controls">
      <input id="fileInput" type="file" accept="image/*" />
      <button id="analyzeBtn">Analiz Et</button>
      <button id="themeToggle">üåô Tema Deƒüi≈ütir</button>
      <label style="display:flex;align-items:center;gap:8px;justify-content:center">
        Etiket:
        <select id="labelSelect">
          <option value="% bot" selected>% bot</option>
          <option value="% deƒüi≈üik adam">% ≈üaka</option>
          <option value="% mal">% eƒülence</option>
        </select>
      </label>
      <div style="color:#bfe8e9;text-align:center">Destek: <span id="support">kontrol ediliyor...</span></div>
    </div>

    <div class="stage">
      <canvas id="canvas"></canvas>
      <div id="results"></div>
    </div>

    <div class="disclaimer">
      <span class="tag">UYARI</span> Bu site sadece ≈üaka i√ßindir üéâ Ger√ßek deƒüerlendirme yapmaz.
    </div>
  </div>

  
<script>
/* ELEMENTLER */
const fileInput = document.getElementById('fileInput');
const analyzeBtn = document.getElementById('analyzeBtn');
const canvas = document.getElementById('canvas');
const resultsDiv = document.getElementById('results');
const supportSpan = document.getElementById('support');
const labelSelect = document.getElementById('labelSelect');
const ctx = canvas.getContext('2d');

/* yardƒ±mcƒ±: resmi y√ºkle */
function loadImageFromFile(file){
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = () => resolve(img);
    img.onerror = (e) => reject(e);
    img.src = URL.createObjectURL(file);
  });
}

/* canvas'a uygun √∂l√ßekte √ßiz */
function drawImageOnCanvas(img){
  const maxW = 480;
  const ratio = img.width / img.height;
  const w = Math.min(maxW, img.width);
  const h = Math.round(w / ratio);
  canvas.width = w;
  canvas.height = h;
  ctx.clearRect(0,0,w,h);
  ctx.drawImage(img,0,0,w,h);
}

/* fake fallback (her zaman bazƒ± kutular √ºretir) */
async function fakeDetect(img){
  drawImageOnCanvas(img);
  const count = Math.floor(Math.random() * 3) + 1;
  const boxes = [];
  for(let i = 0; i < count; i++){
    boxes.push({
      x: Math.random() * (canvas.width * 0.6),
      y: Math.random() * (canvas.height * 0.6),
      width: 70 + Math.random() * 90,
      height: 70 + Math.random() * 90
    });
  }
  return boxes;
}

/* renk + y√ºzde √ºretimi */
function colorForPercent(p){
  if(p < 35) return 'rgba(0,255,100,0.9)';
  if(p < 70) return 'rgba(255,255,0,0.9)';
  return 'rgba(255,60,60,0.9)';
}
function playfulPercent(){
  const r = Math.random();
  if(r < 0.05) return 100;
  if(r < 0.15) return Math.floor(80 + Math.random()*20);
  if(r < 0.5) return Math.floor(30 + Math.random()*50);
  return Math.floor(Math.random()*30);
}

/* --- face-api.js ile model y√ºkleme (hazƒ±r host kullanƒ±lƒ±yor) --- */
/* kƒ±sa yol: modeller hazƒ±r hosttan √ßekiliyor, senin repoya koymana gerek yok */
let faceApiAvailable = false;
async function ensureFaceApi(){
  if (typeof faceapi === 'undefined') {
    faceApiAvailable = false;
    supportSpan.textContent = 'face-api.js y√ºklenmedi ‚Äî fakeDetect kullanƒ±lƒ±yor';
    return;
  }
  try {
    // HAZIR HOST: modeller burada barƒ±nƒ±yor (sen dosya y√ºklemek zorunda deƒüilsin)
    const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';
    await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
    faceApiAvailable = true;
    supportSpan.textContent = 'face-api.js modelleri y√ºklendi';
  } catch (e) {
    console.warn('Model y√ºkleme hatasƒ±:', e);
    faceApiAvailable = false;
    supportSpan.textContent = 'face-api modeli y√ºklenemedi ‚Äî fakeDetect kullanƒ±lƒ±yor';
  }
}

async function analyzeWithFaceApi(img){
  drawImageOnCanvas(img);
  // tinyFaceDetector se√ßenekleri: inputSize hƒ±z/ba≈üarƒ± dengesi, scoreThreshold hassasiyet
  const options = new faceapi.TinyFaceDetectorOptions({ inputSize: 320, scoreThreshold: 0.5 });
  const detections = await faceapi.detectAllFaces(img, options);
  const scaleX = canvas.width / img.width;
  const scaleY = canvas.height / img.height;
  const shrink = 0.85;

  return detections.map(d => {
    const r = d.box;
    const newW = r.width * shrink;
    const newH = r.height * shrink;
    const cx = r.x + r.width / 2;
    const cy = r.y + r.height / 2;
    const newX = cx * scaleX - (newW * scaleX) / 2;
    const newY = cy * scaleY - (newH * scaleY) / 2;
    return {
      x: newX,
      y: newY,
      width: newW * scaleX,
      height: newH * scaleY
    };
  });
}

/* --- Ana akƒ±≈ü --- */
analyzeBtn.addEventListener('click', async () => {
  const f = fileInput.files[0];
  if(!f){ alert('√ñnce bir fotoƒüraf se√ß.'); return; }

  analyzeBtn.disabled = true;
  analyzeBtn.textContent = 'Analiz ediliyor...';
  resultsDiv.innerHTML = '';

  try {
    const img = await loadImageFromFile(f);

    // modelleri bir kez y√ºkle
    if (!window.faceApiInitDone) {
      await ensureFaceApi();
      window.faceApiInitDone = true;
    }

    let boxes = [];

    if (faceApiAvailable) {
      try {
        boxes = await analyzeWithFaceApi(img);
      } catch (e) {
        console.warn('face-api ile tespit hatasƒ±:', e);
        boxes = [];
      }
    }

    // Eƒüer face-api yoksa veya bo≈üsa fallback ile kutular √ºret
    if (!faceApiAvailable || boxes.length === 0) {
      boxes = await fakeDetect(img);
    }

    drawImageOnCanvas(img);

    if(boxes.length === 0) {
      resultsDiv.innerHTML = '<div class="resultItem">Y√ºz bulunamadƒ± ‚Äî ba≈üka foto dene.</div>';
    } else {
      boxes.forEach((b,i) => {
        const pct = playfulPercent();
        const labelText = labelSelect.value.replace('%', pct);
        const color = colorForPercent(pct);

        ctx.lineWidth = 3;
        ctx.strokeStyle = color;
        ctx.strokeRect(b.x, b.y, b.width, b.height);
        
        ctx.font = 'bold 14px sans-serif';
        ctx.textBaseline = 'bottom';
        ctx.fillStyle = color;
        const textX = Math.max(4, b.x);
        const textY = Math.max(14, b.y - 6);
        ctx.fillText(labelText, textX, textY);

        const el = document.createElement('div');
        el.className = 'resultItem';
        el.innerHTML = `<strong>Y√ºz ${i+1}:</strong> <span style="color:${color}">${labelText}</span>`;
        resultsDiv.appendChild(el);
      });
    }
  } catch(err) {
    alert('Hata: ' + (err.message || err));
  } finally {
    analyzeBtn.disabled = false;
    analyzeBtn.textContent = 'Analiz Et';
  }
});
</script>
</body>
</html>






